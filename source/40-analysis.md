# 단위평면 딥 러닝 분석

이 장에서는 한국 아파트의 단위평면이 진화하는 과정을
딥 러닝을 통하여 분석한다.

아파트는 처음 도입되었을 때부터
한국이라는 새로운 환경을 맞이하여 변화하였고,
외국의 아파트와는 다른 한국만의 아파트 계획으로 진화하였다.
그러나 수십 년이 흐르는 동안 한국이라는 환경 또한 끊임없이 변화하였다.
한국 아파트 또한 그에 맞추어 발빠르게 변화해왔다.

이렇게
한국 아파트의 단위평면에서
시기에 따라 변화하는 계획 특성을
딥 러닝을 통하여 분석하고,
각 시기에 나타나는 평면 계획의 진화 양상을 보여주는
시기별 대표 단위평면을 도출한다.
딥 러닝 모형이 학습한
다른 시기와 구분되는
각 시기만의 평면 계획 특성을
연구자가 파악할 수 있도록 시각화한다.

## 분석 설계

단위평면이 진화한다는 것은
외부 환경에 대응하여
기존에 없던 새로운 평면 계획이 등장하고,
그러한 계획이 더 많은 아파트에 받아들여지면서
한국 아파트의 주류가 되는 과정이
반복된다는 뜻이다.
이러한 과정을 분석하기 위하여
각 시기별로 단위평면에서 나타나는 평면 계획 특성을 파악하고
그러한 변화가
해당 시기의 외부 환경과
어떠한 관계를 가지는지 해석할 필요가 있다.

먼저, 단위평면 공간배치 데이터를 분석할 수 있는 딥 러닝 모형을 선정한다.
여러 대상에 대한 사진을 인식하고 분류하기 위하여 개발된 딥 러닝 모형이
시기별 단위평면의 차이를 분석하는 데 활용될 수 있다.
사진 대신 아파트 단위평면에서,
서로 다른 대상을 분류하는 대신에 서로 다른 시기를 분류하는 것이다.
다양한 이미지 분류 딥 러닝 모형 중에서
단위평면 진화과정 분석의 전 과정을 고려할 때
가장 적합한 모형을 선정하고,
본 연구의 분석을 수행할 수 있도록 수정하여 적용한다.

진화가 일어나는
연속적인 시간의 흐름을
이산적인 (discrete) 분류 모형으로 분석하기 위하여
시기 구분을 정의한다.
특히, 본 연구의 딥 러닝 분석을 통해 도출된 결과를
선행연구의 결과와 비교하기 위하여
선행연구의 시기 구분을 참고하여 유사한 기준을 적용한다.

시기별 한국 아파트의 진화과정을 대표할 수 있는
단위평면 사례를 선정한다.
...

단위평면에서 해당 시기의 진화과정에 해당하는 부분을 시각화하여
연구자가 해석할 수 있도록 한다.
...

## 시기 구분

시간의 흐름에 따른 변화를 분석하는 시계열 분석에서
적절한 시기 구분의 설정은 중요하다.
...
여러 선행연구에서
각 십 년대를 전후반으로 나눈 5년 주기를
시기 구분의 기준으로 설정하는 경우가 많았다.
본 연구에서도
단위평면 데이터셋에 포함된 준공연도를 기준으로
1969년부터 2019년까지 분포하는 평면 유형을
10개의 시기로 구분한다.
(1969년은 1970년대 전반으로 분류)

시기         |준공연도  |시기적 상황
------       |-----     |---------------
1970년대 전반|1969--1974|여의도 시범아파트 (1971)
1970년대 후반|1975--1979|강남개발, 아파트 지구 (1975)
1980년대 전반|1980--1984|2차 석유 파동 (1978--1981)
1980년대 후반|1985--1989|목동 신시가지 (1983), 3저 호황 (1986--1989)
1990년대 전반|1990--1994|수도권 1기 신도시 (1988)
1990년대 후반|1995--1999|외환위기 (1997), 분양가 자율화 (1999)
2000년대 전반|2000--2004|탑상형 아파트 도입 (2002)
2000년대 후반|2005--2009|발코니 확장 허용 (2006), 분양가 상한제 (2007), 뉴타운 (2002)
2010년대 전반|2010--2014|서브프라임 모기지 금융위기 (2008), 전국 주택보급률 100% 초과 (2008)
2010년대 후반|2015--2019|주택시장 안정대책 (2017), 도시재생 뉴딜 (2017)

: 한국 아파트 시기 구분 {#tbl:period}

## 딥 러닝 모형

한국 아파트의 단위평면이 진화하는 과정을 분석하기 위하여,
단위평면 공간배치에서 나타나는 차이를 학습하여
각 시기별 단위평면을 구분할 수 있는 딥 러닝 모형을 선정하고
단위평면 진화과정 학습에 맞게 수정하여 반영한다.

딥 러닝 모형의 선정 기준은 크게 두 가지이다.
첫 번째는 이미지 형태로 정리된 단위평면 데이터셋에서
평면 계획 특성을 학습할 수 있는 능력이 있어야 하며,
두 번째는 학습된 시기별 평면 계획 특성을
사람이 해석할 수 있어야 한다.
대부분의 딥 러닝 모형은 다양한 이미지 학습 능력이 뛰어나지만,
두 번째 해석가능성 측면에서는 매우 불리하다.

Zhou 등 [-@Zhou2015]이 개발한 CAM 방법론은
딥 러닝의 해석가능성을 높이기 위한 방법이다.
이미지가 해당 범주로 분류된 이유를
이미지 안의 특정 영역의 형태로 제시할 수 있다.
단위평면에서 해당 시기에서 나타나는 계획 특성이라고 판단한 부분을
보여줄 수 있다는 의미이다.
이러한 특징 덕분에 CAM 기법은 단위평면 분석에 적합하다.

CAM 방법론에서 딥 러닝에 CAM 기법을 적용하기 위하여
저자들은 딥 러닝 모형의 마지막 계층에
GAP (global average pooling) 계층을 적용하였다.
이러한 기법이 적용된 딥 러닝 모형은
AlexNet, VGGNet, GoogLeNet 3가지가 있었는데,
세 모형 모두 이미지 분류 문제를 해결하기 위하여 개발된 딥 러닝 모형이다.
이 중 VGGNet과 GoogLeNet이
여러 기준에서 비슷하게 가장 뛰어난 성능을 보였다 [@Zhou2015].
두 모형 모두 본 연구에 활용하기에 적합하지만,
VGGNet이 더 단순한 신경망 구조를 갖추고 있어
단위평면 공간배치 분석 모형에 선정한다 [@simonyan2014deep].

원래 VGGNet과 마찬가지로
마지막 계층을 GAP로 바꾼 VGG-GAP 모형 또한
시기별 단위평면의 공간배치를 분류하는 데 그대로 사용할 수는 없다.
딥 러닝은
특정 용도에 전문화되지 않고
다양한 데이터를 학습할 수 있는 방법론이지만,
원래 여러 가지 대상의 사진을 사진을 분류하는 용도로 개발되었기 때문에
입력 데이터의 차원부터 학습된 분류 기준까지 모두 다르기 때문이다.
그러나 단위평면 데이터셋에 맞추어
수정한 새로운 딥 러닝 모형에
데이터셋을 처음부터 학습시키는 과정을 거치면
사진 대신 공간배치를 분류하는 딥 러닝 모형을 만들 수 있다.

구체적으로,
본 연구에 적용하는 수정 VGG-GAP 모형은
단위평면을 56\times 56\times 6 크기의 행렬 형태로 입력받아,
VGGNet의 CNN 계층을 적용하고,
그 다음으로 512개 차원에 대한 GAP 계층이 위치한다.
출력층에서는 데이터셋에서 학습된 특성 512개를 종합하여
해당 평면이 속한 시기를 10개 시기 중 하나로 판단한다 (@fig:vgg).

![수정 VGG-GAP 모형 구조](vgg-gap.png){#fig:vgg}

본 연구에서는 텐서플로우 (Tensorflow)의
케라스 (Keras) API를 이용하여
수정 VGG-GAP 모형을 구현하였다.
구현된 모형의 요약은 [@fig:summary]와 같다.
[@sec:floorplan]의 한국 아파트 단위평면 데이터셋을 적용하여
한국 아파트 단위평면의 시기별 공간배치를 학습시킨다.

![수정 VGG-GAP 모형 케라스 구현 개요](summary.png){#fig:summary}

## 시기별 대표 평면

한국 아파트의 시기별 진화과정을 분석하기 위하여
단위평면 5만 개 각각을 연구자가 해석하는 것은
불가능하고 본 연구의 방법론을 개발하는 이유에도 어긋난다.
따라서 시기별 진화과정을 대표할 수 있는
단위평면 사례를 선정할 필요가 있다.
분류 모형에서는 같은 시기에 속한 평면을 똑같이 분류하지만,
그 안에서도 해당 시기의 평면 특성에 더 잘 들어맞는 평면은
더 높은 점수를 받게 된다.

특히, 단순히 해당 시기에 많이 등장하는 평면 유형보다도,
이전 시기에는 없다가 해당 시기에 들어 새롭게 등장한 평면 유형이
해당 시기의 진화과정을 대표하기에 더 적절할 수 있다.
본 연구에서는 한국 아파트 진화과정을 대표할 수 있는 평면을 선정하기 위하여,
데이터셋 전체에 대하여 시기 분류를 결정하는 근거가 되는 GAP 계층의 출력값을 사용한다.
이 출력값이 평면 유형의 해당 시기에서 높으면서 그 직전 시기에는 낮아야
해당 시기에 새롭게 등장한 평면 계획으로 판단하는 것이다.
이를 위하여 해당 시기 출력값에서 직전 시기 출력값을 뺀 값을
해당 시기 진화과정의 대표 점수로 정의한다.

시기별 대표 평면 도출은 두 단계로 진행된다.
먼저, 512개 특성 각각에 대하여 가장 높은 점수를 받은 평면을 선별한다.
다음으로, 그 중에서 각 시기별로 대표 점수가 가장 높은 평면들을
해당 시기의 대표 평면으로 선정한다.

## 시기별 계획 특성 시각화

선정된 대표 평면에 대하여 CAM 분석을 수행한 결과를 해석하여
시기별 한국 아파트 단위평면의 진화과정을 분석한다.
CAM 분석을 통하여
각 단위평면이 어떤 특성 때문에 해당 시기로 분류되었는지 해석할 수 있다.
단위평면을 시기별로 분류하도록 학습된 512개 평면 특성은
그 특성에 잘 들어맞는 평면이
특정 시기로 분류되거나 분류되지 않도록 영향을 미친다.
이것을 평면의 각 영역이 512개 특성 평가에 미치는 영향과 곱하면,
평면의 각 영역이 특정 시기로 분류되도록 하는 영향력을 계산할 수 있다.
[@fig:cam]은 VGGNet의 마지막 CNN 계층에서
GAP 계층을 거쳐 시기 분류로 이어질 때
단위평면의 어떤 영역이 해당 시기 분류에 영향을 미쳤는지
CAM을 통해 분석하는 과정이다.

![CAM 분석 구조](cam.png){#fig:cam}

## 결과

한국 아파트 단위평면 데이터셋을
수정 VGG-GAP 모형에 학습시킨 결과,
준공 시기를 정확하게 분류한 사례는 56%로 나타났다.
그러나 직전/직후 구간으로 잘못 분류한 사례 또한 33%나 되어,
합치면 89%의 사례에 대하여 5년 이내의 오차로
준공 시기를 예측할 수 있었다 (@fig:5y).

![준공 시기 예측 결과](vgg_5y_heatmap.pdf){#fig:5y width=75%}

512개 특성 각각에 대해 가장 높은 점수를 받은 평면은 총 438개 사례로,
대부분의 사례가 1990년 이후 준공되었다.
실제 아파트 재고와 전체 데이터셋에서도
1990년 이후 준공된 비중이 높기 때문에,
딥 러닝 모형이
더 많은 사례가 존재하는 시기를 구분하기 위한 특성을
주로 학습하였기 때문으로 판단된다.

따라서 [@sec:evolution]에서는, 시기별 대표 평면의 해석과
그에 따른 한국 아파트의 진화과정 분석도
해당 시기로 한정하고,
1990년대 이후 시기별 단위평면의 진화과정을 분석한다.
