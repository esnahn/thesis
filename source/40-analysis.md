# 단위평면 딥 러닝 분석 방법론

이 장에서는
한국 아파트의 단위평면을
딥 러닝을 통하여 분석하는 방법론을
구축한다.
[@sec:floorplan]에서 구축한
한국 아파트 단위평면 데이터셋을 활용하여
시기나 지역에 따른 한국 아파트의 변화 등
다양한 연구에 활용할 수 있고,
나아가 새로운 데이터셋을 적용하여
일반적인 건축 공간에 대한 분석이 가능한
방법론을 목표로 한다.

## 분석 설계

한국 아파트에 대한 연구에서는
단위평면을 유형으로 분류하거나
시기 및 지역에 따라 분류하여 비교하는 경우가 많다.
딥 러닝이 처리할 수 있는 다양한 작업 중에서,
대상을 여러 범주 중 하나로 분류하는 것은
기계학습과 딥 러닝에서 중요하게 연구되는 작업이다.
손글씨를 인식하여 숫자를 구분하는 MNIST나,
사진에서 사물을 식별하는 CIFAR-10, CIFAR-100 등을 포함하여,
수많은 데이터셋이 분류를 수행하는 기계학습 모형의 학습을 위하여 구축되었다.
딥 러닝 분류 모형에 대한 연구도 활발하게 이루어진다.
따라서
한국 아파트 데이터셋에 대한 딥 러닝 분석에서도
데이터에서 규칙을 학습하는 딥 러닝의 귀납적 특성을 적용하여
단위평면 분류를 수행할 수 있다.

단위평면의 공간적 특성과 직접적으로 연관되는
유형 분류의 경우,
딥 러닝을 적용하면
유형의 기준을 명시적으로 정의하지 않고도
예시를 통해 유형의 특성을 학습하고
분류를 자동으로 수행하는 것이 가능하다.
예를 들어, 발코니 확장을 염두에 두고 계획된 평면을 정의하는 것이 어렵더라도,
발코니 확장을 기본으로 제시하는 평면을 학습시켜 그와 유사한 평면을 유형화할 수 있다.

한편,
시기 및 지역 등 조건에 따라 단위평면을 비교하는 연구에서는,
건축 공간과 사회 현상의 상호작용에서 발생하는 간접적인 관계를 분석한다.
정량적 방법론을 적용한 연구에서는
공간구문론 등 다양한 이론을 적용하여 공간의 특성을 수치화하고,
그 값의 분포를 통계적으로 비교하여 차이를 분석하게 된다.
그러나 딥 러닝을 건축 공간에 적용하고 특정한 범주로 분류하도록 학습시키면,
공간의 특성을 하나의 값으로 환원하는 대신,
입력 데이터 전체를 고려한 차이점을 찾는다.
이 차이점이
곧 딥 러닝이 데이터에서 귀납적으로 학습한 분류의 기준이 된다.
이렇게 학습된 규칙을 해석하고 시각화하여
다양한 분류 기준에 따른 단위평면의 변화를 분석할 수 있다.

본 연구에서는
딥 러닝을 활용하여
한국 아파트의 단위평면과
다양한 사회 현상 사이의
관계를 분석할 수 있는 방법론을 구축한다.
한국 아파트 단위평면 데이터셋에서
모든 단위평면에 대하여 제공되는
시기 및 지역 데이터를 활용하여
한국 아파트 시기에 따른 변화와 지역 간 차이를 분석하는 것을 목표로 한다.
그러나 본 연구에서 구축한 분석 방법론은
데이터를 추가하기만 하면
다른 기준에 대한 분류 및 비교 분석에도
동일하게 적용할 수 있다.

먼저,
한국 아파트 단위평면과의 관계를 분석할 변수를 설정한다.
딥 러닝 모형을 적용하기 위하여
분석 변수가 가져야 할 특성을 확인하고,
단위평면 데이터셋에 포함된
시기 및 지역 데이터를 그에 맞추어 전처리한다.

다음으로,
단위평면 공간배치를 인식하고 분석하는 딥 러닝 모형을 설정한다.
2차원 이미지 형태의 공간배치를 처리할 수 있는 딥 러닝 모형 중에서,
데이터에서 학습한 규칙을 해석할 수 있는 모형을 선정한다.
이 모형을
한국 아파트 단위평면 데이터셋의 공간배치 데이터에 맞추어 수정하여 적용한다.

마지막으로,
한국 아파트 단위평면의 공간배치를 분석하여 발견한 결과를 해석하고
사람이 이해할 수 있도록 표현하는 방법론을 수립한다.
한국 아파트 전수에 대하여 분석한 결과를 대표할 수 있는 단위평면을 선정하고,
딥 러닝이 발견한 규칙을 대표 단위평면에 시각화한다.

이러한 과정을 통하여
한국 아파트 단위평면 연구에 딥 러닝을 적용하여 분석하는 방법론을 구축한다.

## 분석 변수 설정

단위평면의 공간배치와 대응하여 분석할 변수의 성격을 설정하고
한국 아파트 단위평면 데이터셋의 시기 및 지역 데이터를
딥 러닝 분석을 적용할 수 있는 방식으로 전처리한다.

단위평면의 공간배치를 유형화하거나,
다양한 조건에 따른 단위평면의 차이를 분석하는 연구를 위하여
입력 데이터를 다른 변수에 따라 분류하는 딥 러닝 모형을 적용할 필요가 있다.
단위평면을 분류하는 기준이 되는 변수는
연구의 성격에 따라 다양하게 정의될 수 있다.

유형화 연구에서는
단위평면의 공간적 특성과 직접적으로 연관된 범주가 분류 기준이 된다.
단위평면을 분류하는 유형은 이미 결정되어 있으나
유형별 공간배치의 차이를 분석하고자 하는 경우에
딥 러닝 분석을 활용할 수 있다.

단위평면을 분류하고 그 사이의 차이를 분석하기 위한 집단 변수는
유형 뿐만 아니라 무엇이든 될 수 있다.
딥 러닝은 주어진 데이터에 따라 다양한 분류 작업을 수행할 수 있기 때문이다.
한국 아파트 단위평면 데이터셋에 포함된 시기와 지역 외에도,
주동 형식이나 단지 규모 등 단위평면에 영향을 미치는 계획적 요인,
평균 연령이나 가구원 수 등 사회적 요인
등에 따른 분류도 가능하다.

다만, 딥 러닝은 학습을 위하여 매우 많은 수의 폭넓은 데이터를 필요로 하기 때문에,
한국 아파트 단위평면 데이터셋의 규모는
분류 작업을 수행할 수 있는 변수에 대한 한계로 작용한다.
딥 러닝 학습을 위해 구축된 기존 데이터셋에서는
사례 수에 따라 분류 범주의 수가 크게 제한된다.
약 5만 개 사례를 포함하는 단위평면 데이터셋과 비슷한 규모의 데이터셋을 예로 들면,
7만 개 규모의 MNIST와,
6만 개인 CIFAR-10,
10만 개 이상 사례를 포함하는 SVHN까지,
모두 10가지 범주의 분류 과제를 위하여 구축되었다.
이러한 데이터셋을 잘 처리할 수 있도록 개발된 딥 러닝 모형을
단위평면 분석에 적용하려면,
그 분류 범주도 10가지 내외로 설정하는 것이 적절하다고 판단된다.

딥 러닝 분류 모형은 아주 간단하게 회귀 모형으로 변형할 수 있기 때문에,
단위평면과 비교하여 분석되는 변수는 연속형 변수가 될 수도 있다.
회귀 분석에서 딥 러닝은
그 변수의 값을 모든 구간에서 높이거나 낮추는 요인을
단위평면에서 찾게 된다.

### 시기 변수 설정

딥 러닝 모형이 단위평면을 시기별로 분류할 수 있도록
연속적인 시간을 이산적인 (discrete) 구간으로 나누어
시기 변수를 설정한다.

한국 아파트 단위평면 데이터셋에서
아파트의 건설 시기는
1969년부터 2019년까지의 준공연도로 제공된다.
(데이터셋에는 0에서 1 사이의 값으로 정규화가 되어있다.)
약 50년의 시간을 10개 시기로 구분한다면
5년 내외의 구간으로 나누어지게 된다.

한국 아파트에 대한 선행연구에서는
한국 사회와 아파트 건설과 관련된 중요 사건
(1989년 주택 200만호 건설 등)에
맞추어 1--2년씩 시기를 조절하는 경우도 있지만
대체로 10년 단위 연대나 이를 둘로 나눈 5년 단위 전후반을 기준으로 시기를 설정한다.
이에 따라
본 연구에서도
단위평면 데이터셋에 포함된 준공연도를
5년 단위 전후반을 기준으로 나누어,
1969년부터 2019년까지 분포하는 평면 유형을
10개의 시기로 구분한다.
(1969년은 1970년대 전반으로 분류)

시기         |준공연도  |시기적 상황
------       |-----     |---------------
1970년대 전반|1969--1974|여의도 시범아파트 (1971)
1970년대 후반|1975--1979|강남개발, 아파트 지구 (1975)
1980년대 전반|1980--1984|2차 석유 파동 (1978--1981)
1980년대 후반|1985--1989|목동 신시가지 (1983), 3저 호황 (1986--1989)
1990년대 전반|1990--1994|수도권 1기 신도시 (1988)
1990년대 후반|1995--1999|외환위기 (1997), 분양가 자율화 (1999)
2000년대 전반|2000--2004|탑상형 아파트 도입 (2002)
2000년대 후반|2005--2009|발코니 확장 허용 (2006), 분양가 상한제 (2007), 뉴타운 (2002)
2010년대 전반|2010--2014|서브프라임 모기지 금융위기 (2008), 전국 주택보급률 100% 초과 (2008)
2010년대 후반|2015--2019|주택시장 안정대책 (2017), 도시재생 뉴딜 (2017)

: 한국 아파트 시기 구분 {#tbl:period}

시간의 흐름에 따른 한국 아파트의 변화는
범주형 변수와 연속형 변수 어느 쪽으로도 분석이 가능한 대상이다.
준공연도는 연속형 변수이므로
분류 모형이 아니라 회귀 모형으로 단위평면을 분석하는 경우에도 적용이 가능하다.
딥 러닝 모형에 적용하기 위해서는 정규화가 필요하지만,
데이터셋에서 이미 0--1로 정규화가 되어 추가적인 전처리가 필요하지 않다.
따라서 1969년을 0으로, 2019년을 1로 정의하는 정규화한 준공연도를
딥 러닝 학습에 그대로 사용할 수 있다.

### 지역 변수 설정

단위평면 데이터셋에서
아파트가 위치한 지역은
사례 수의 배분을 고려한
9개 시도별 권역으로 분류된다.
이러한 분류는 10가지 내외 범주라는 변수 설정 목표에 부합하며,
사례 수 배분을 고려하였기 때문에 딥 러닝 모형의 학습에도 적합하다.
따라서 지역 변수도 9개 시도별 권역을 그대로 설정한다.

|권역코드|해당 지역|평면유형 수|
|:---:|-------------------------------|---------:|
|0|서울|15,125|
|1|경기|14,444|
|2|인천|3,288|
|3|강원|1,107|
|4|대전, 세종, 충남, 충북|4,226|
|5|부산, 울산, 경남|6,866|
|6|대구, 경북|3,242|
|7|광주, 전남, 전북|2,075|
|8|제주|167|

: 지역 변수 설정

다만, 시도별 권역이라는 변수를 바로 단위평면과 비교하는 분석이
가능하고 또 의미가 있는 것은
권역별로 단위평면 계획에 차이가 날 경우이다.
만약 동일한 단위평면 계획이 전국적으로 적용되었다면,
딥 러닝을 통하여 단위평면을 지역별로 구분하는 것이 불가능하거나,
의미 없는 결과를 도출하게 된다.
따라서 지역 변수는 딥 러닝 분석에 적절하게 설정되었더라도,
지역별 단위평면 계획을 비교하는 연구는 더 섬세한 가설과 분석 설계가 필요하다.

## 딥 러닝 모형

한국 아파트의 단위평면이 진화하는 과정을 분석하기 위하여,
단위평면 공간배치에서 나타나는 차이를 학습하여
각 시기별 단위평면을 구분할 수 있는 딥 러닝 모형을 선정하고
단위평면 진화과정 학습에 맞게 수정하여 반영한다.

딥 러닝 모형의 선정 기준은 크게 두 가지이다.
첫 번째는 이미지 형태로 정리된 단위평면 데이터셋에서
평면 계획 특성을 학습할 수 있는 능력이 있어야 하며,
두 번째는 학습된 시기별 평면 계획 특성을
사람이 해석할 수 있어야 한다.
대부분의 딥 러닝 모형은 다양한 이미지 학습 능력이 뛰어나지만,
두 번째 해석가능성 측면에서는 매우 불리하다.

Zhou 등 [-@Zhou2015]이 개발한 CAM (class activation mapping) 방법론은
딥 러닝의 해석가능성을 높이기 위한 방법이다.
이미지가 해당 범주로 분류된 이유를
이미지 안의 특정 영역의 형태로 제시할 수 있다.
단위평면에서 해당 시기에서 나타나는 계획 특성이라고 판단한 부분을
보여줄 수 있다는 의미이다.
이러한 특징 덕분에 CAM 기법은 단위평면 분석에 적합하다.

CAM 방법론에서 딥 러닝에 CAM 기법을 적용하기 위하여
저자들은 딥 러닝 모형의 마지막 계층에
GAP (global average pooling) 계층을 적용하였다.
이러한 기법이 적용된 딥 러닝 모형은
AlexNet, VGGNet, GoogLeNet 3가지가 있었는데,
세 모형 모두 이미지 분류 문제를 해결하기 위하여 개발된 딥 러닝 모형이다.
이 중 VGGNet과 GoogLeNet이
여러 기준에서 비슷하게 가장 뛰어난 성능을 보였다 [@Zhou2015].
두 모형 모두 본 연구에 활용하기에 적합하지만,
VGGNet이 더 단순한 신경망 구조를 갖추고 있어
단위평면 공간배치 분석 모형에 선정한다 [@simonyan2014deep].

원래 VGGNet과 마찬가지로
마지막 계층을 GAP로 바꾼 VGG-GAP 모형 또한
시기별 단위평면의 공간배치를 분류하는 데 그대로 사용할 수는 없다.
딥 러닝은
특정 용도에 전문화되지 않고
다양한 데이터를 학습할 수 있는 방법론이지만,
원래 여러 가지 대상의 사진을 사진을 분류하는 용도로 개발되었기 때문에
입력 데이터의 차원부터 학습된 분류 기준까지 모두 다르기 때문이다.
그러나 단위평면 데이터셋에 맞추어
수정한 새로운 딥 러닝 모형에
데이터셋을 처음부터 학습시키는 과정을 거치면
사진 대신 공간배치를 분류하는 딥 러닝 모형을 만들 수 있다.

구체적으로,
본 연구에 적용하는 수정 VGG-GAP 모형은
단위평면을 56\times 56\times 6 크기의 행렬 형태로 입력받아,
VGGNet의 CNN 계층을 적용하고,
그 다음으로 512개 차원에 대한 GAP 계층이 위치한다.
출력층에서는 데이터셋에서 학습된 특성 512개를 종합하여
해당 평면이 속한 시기를 10개 시기 중 하나로 판단한다 (@fig:vgg).

![수정 VGG-GAP 모형 구조](vgg-gap.png){#fig:vgg}

본 연구에서는 텐서플로우 (Tensorflow)의
케라스 (Keras) API를 이용하여
수정 VGG-GAP 모형을 구현하였다.
구현된 모형의 요약은 [@fig:summary]와 같다.
[@sec:floorplan]의 한국 아파트 단위평면 데이터셋을 적용하여
한국 아파트 단위평면의 시기별 공간배치를 학습시킨다.

![수정 VGG-GAP 모형 케라스 구현 개요](summary.png){#fig:summary}

## 분석 결과의 해석

딥 러닝 모형이 학습한
한국 아파트 단위평면과 분석 변수 사이의 관계를 해석하고
그 내용을 시각화하는 방법론을 수립한다.
딥 러닝은 데이터에서 귀납적으로 학습하여 다양한 작업을 수행할 수 있지만,
딥 러닝 모형의 내부 구조를 이해하기는 어렵다.
단위평면에 대한 딥 러닝 분석을 통하여
한국 아파트에 대한 전수조사를 수행하기 위해서는,
딥 러닝 모형이 데이터에서 학습한 규칙을 해석할 수 있어야 한다.
따라서
딥 러닝 모형의 내부 구조를 해석하는 방법론을 적용하여
딥 러닝이 데이터에서 도출한 단위평면의 분류 기준을
사람이 이해할 수 있도록 표현하는 방법론을 수립한다.

<!-- 한국 아파트 전수에 대하여 분석한 결과를 대표할 수 있는 단위평면을 선정하고,
딥 러닝이 발견한 규칙을 대표 단위평면에 시각화한다. -->

<!--

시기별 한국 아파트의 진화과정을 대표할 수 있는
단위평면 사례를 선정한다.

단위평면에서 해당 시기의 진화과정에 해당하는 부분을 시각화하여
연구자가 해석할 수 있도록 한다.
-->

### 단위평면 특성 시각화

딥 러닝 분류 모형에
CAM 분석을 적용하여
한 단위평면이 해당 범주로 분류된 이유를
시각화하고,
이를 통해 단위평면의 분류 기준을 해석할 수 있도록 한다.

CAM 분석을 통하여
딥 러닝 분류 모형에 한 단위평면을 입력하였을 때
그 평면에서 어느 영역 때문에 해당 범주로 분류되었는지 시각화할 수 있다.

단위평면을 시기별로 분류하도록 학습된 512개 평면 특성은
그 특성에 잘 들어맞는 평면이
특정 시기로 분류되거나 분류되지 않도록 영향을 미친다.
이것을 평면의 각 영역이 512개 특성 평가에 미치는 영향과 곱하면,
평면의 각 영역이 특정 시기로 분류되도록 하는 영향력을 계산할 수 있다.
[@fig:vgg_cam]은 VGGNet의 마지막 CNN 계층에서
GAP 계층을 거쳐 시기 분류로 이어질 때
단위평면의 어떤 영역이 해당 시기 분류에 영향을 미쳤는지
CAM을 통해 분석하는 과정이다.

![CAM 분석 구조](cam.png){#fig:vgg_cam}

### 대표 평면 선정

CAM 분석은 각 단위평면이 어떤 이유로 분류되었는지 해석할 수 있게 하지만,
단위평면 데이터셋의 수만 개 사례에 대한 전수조사 결과를 확인하기 위하여
이를 하나하나 확인하는 것은 불가능하다.
통계분석에서 집단을 대표하는 값으로 평균 등을 활용하듯이,
각 범주의 특성을 압축적으로 표현할 방법이 필요하다.
이를 위하여,
분석 변수의 각 범주를 대표할 수 있는
대표 단위평면를 선정한다.
이에 대한 CAM 분석 결과와 그 해석으로
해당 범주에 속하는 단위평면의 특성을 대표한다.

어떠한 단위평면이 해당 범주를 가장 잘 대표하는지는
분석 변수의 성격에 따라 달라진다.
가장 단순하게는,
딥 러닝 모형이 가장 확실하게 해당 범주로 분류한 단위평면이 대표가 될 수 있다.
분류 모형의 출력층에서는 각 범주별로 점수가 도출되고,
여러 범주 중에서 가장 높은 점수를 얻은 범주로 단위평면을 분류한다.
같은 범주에 속한 평면 중에서도,
해당 범주의 평면 특성에 더 잘 들어맞는 평면은 더 높은 점수를 받게 된다.
이 때 한 범주로 분류된 모든 사례 중에서 해당 범주의 점수가 가장 높은 단위평면이
그 범주의 대표 단위평면이 된다.

또는, 가장 확실하게 다른 범주가 아니라 해당 범주인 단위평면이 대표일 수 있다.
분류 모형은 한 단위평면을 하나의 범주로만 분류하도록 학습되지만,
그럼에도 불구하고 여러 범주에서 높은 점수를 받는 사례가 있을 수 있다.
이 경우 아무리 높은 점수를 받더라도
단 하나의 범주를 대표하는 사례로는 부적합하다고 판단할 수 있다.
따라서 이 때는 다른 범주의 점수는 낮고 해당 범주의 점수만 높은 단위평면이 대표 평면이 된다.

시기별 특성 분석의 경우에는 시간의 흐름에 대한 추가적인 고려가 필요하다.
이전 시기에는 없다가 해당 시기에 최초로 등장한 단위평면은
그 시기에 일어난 단위평면의 변화를 설명하기에 적합하다.
그러나 그 평면이 이후 시기에 계속 등장하더라도
그러한 사실이 대표성을 훼손하는 것은 아니다.
따라서 시기별 분류 모형의 경우에는
다른 시기는 무시하고
해당 시기 점수가 높고 직전 시기 점수는 낮은 단위평면을 대표로 삼는다.

본 연구에서는 한국 아파트 진화과정을 대표할 수 있는 단위평면을 선정하기 위하여,
출력층의 해당 시기 점수에서 직전 시기 점수를 뺀 값을
해당 시기 진화과정의 대표 점수로 정의하고,
이 값이 가장 높은 단위평면을 선정한다.

이렇게 선정된 대표 평면에 CAM 분석을 수행하고,
그 결과를 해석하여
시기별 한국 아파트 단위평면의 진화과정을 분석할 수 있다.
