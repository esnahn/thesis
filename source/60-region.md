# 지역별 단위평면 계획 시차 분석

## 목적

<!--
우선 누구나 이해할 수 있게 쉽게만 설명이 되면
어디에 써먹을지 없어도
-->

한국 아파트의 단위세대 공간배치가 진화한 과정을
[@sec:floorplan]에서 구축한 공간배치 데이터셋을 활용하여 분석한다.
이를 통해 한국 아파트 데이터셋과 기계학습을 통한 건축공간 분석 방법론을 검증한다.

한국 아파트 데이터셋의
평면도를 보고 준공연도를 예측하는 심층 신경망 모형을 학습시킨다.

한국 아파트의 진화과정에서 나타나는
지역별 시차를 분석하고
새롭게 등장하는 한국 아파트의 평면 유형이
지리적으로 전파되는 과정을 밝힌다.

## 공간배치 진화과정 학습 모형

### 방법

이미지로 제공되는 아파트의 공간배치에서 준공연도를 예측하는 분석을 위하여
본 연구에서는 다차원 배열의 분석에 특화된 합성곱 신경망 모형을 적용한다.
이미지나 바둑판과 마찬가지로, 2차원 평면의 모습을 옮겨놓은 평면도도
동서남북의 모든 방향으로 인접한 지점 사이에 밀접한 관계가 존재한다.
합성곱 신경망은 가까이 위치한 지점들이 더 이른 계층에서 연결되도록 하는 구조 덕분에
다차원 공간에 대한 인식에 강점이 있다.

VGGNet [@simonyan2014deep]은 비교적 단순한 구조에도 좋은 성능을 보여주는 합성곱 신경망 모형이다.
여러 알고리즘이 이미지 인식 및 분류 성능을 경쟁하는
ILSVRC (ImageNet Large Scale Visual Recognition Competition) 2014년 대회의 해당 부문에서
2위의 성적에 그쳤음에도 불구하고 많은 관심을 받았다.
기존 연구에 비해 신경망의 계층을 2배 이상 늘려
더 깊은 구조의 신경망으로 좋은 결과를 얻을 수 있음을 보여주었기 때문이다.
사람보다 더 이미지 분류를 정확하게 해내는 최신 신경망 모형들보다는 성능이 떨어지지만,
심층 신경망 학습의 가능성을 탐색하기 위한 목적으로는 충분하다.

본 연구에서는 VGGNet을 작은 이미지에 맞게 구현한 SmallerVGGNet [@Rosebrock2018]을 기반으로
공간배치 데이터셋과 준공연도 예측이라는 목표에 맞게 변형하여 분석 모형으로 적용한다.

공간배치 진화과정 분석 모형의 첫 단계는 입력층의 값을 무작위로 변형하는 것이다.
이를 통해 이미지의 사소한 특징을 외워 준공연도를 알아내는 것을 방지하고
약간의 변형에도 달라지지 않는 전체 공간배치를 인식하도록 강제한다.
구체적으로, Dropout 계층을 두 단계에 걸쳐 적용하여 무작위로 선택된 점들에 대해 모든 정보를 없앤다.
이 때 일부 지점에서는 모든 정보를 없애고, (있는 것도 없는 것도 아닌 상태 -- 0으로 묘사)
또 다른 지점에서는 무작위로 여러 공간이 존재하는 것으로 표현하며, (일부 값이 1)
마지막으로 전체 공간에 대해 가우시안 노이즈를 더한 이미지로 준공연도를 예측할 수 있도록 학습시킨다.
그렇게 노이즈를 적용하여 변형한 이미지를 시각화하면 [@fig:dropout]과 같다.

<div id="fig:dropout">

![적용 전](dropout_before.pdf){height=25%} \qquad
![적용 후](dropout_after.pdf){height=25%}

무작위 노이즈 적용 결과 시각화
</div>

이렇게 입력 데이터를 변형하는 과정은
훈련(training) 과정에만 적용되고 시험(test) 및 실제 활용 과정에서는 적용되지 않는다.
시험 데이터셋은 평면도 인식을 훈련하는 과정에 사용되지 않고
오직 학습 상황을 평가하는 용도로만 사용되므로
원본 이미지를 사용해도 분석 모형에 나쁜 영향을 끼칠 우려가 없기 때문이다.
마찬가지로 학습이 끝난 후 완성된 모형으로 각 평면유형에서 준공연도를 추론하는 활용 단계에서도
원본 이미지를 그대로 사용한다.

그 다음에는 이미지에서 특징을 추출해내는 합성곱 계층이 이어진다.
이 단계에서 신경망은 국지적인 특성들을 종합하여 전반적인 특징을 찾아내게 된다.
합성곱 계층에서는
2차원 합성곱 신경망,
ReLU (Rectified Linear Unit) 활성화 함수,
배치 정규화 (Batch Normalization),
최대 풀링 (Max Pooling),
추가적으로 훈련 단계에서 무작위로 정보를 제거하는 Dropout 계층을 반복하면서
국지적인 연결의 연쇄를 통해 전체 이미지가 연결된다.
이러한 과정을 통해 이미지 전체에서 찾아낸 전반적인 특징을 통합하여 결과로 도출한다.

마지막 단계의 완전연결 계층은 한 계층의 모든 노드가 다음 계층의 모든 노드와 연결되어 있는 신경망이다.
이 단계의 목적은 이미지에서 추출된 특징들로 준공연도를 추론하는 것이다.
합성곱 신경망이 찾아낸 128개 특성에 대해 $2 \times 2 = 4$개씩 총 512개 노드를 입력으로 받아
정규화된 준공연도를 예측하는 1개 노드를 최종 출력으로 도출한다.
국지적으로만 연결된 합성곱 신경망 대신 모든 노드가 연결된 밀집 신경망을 사용하는 차이를 제외하면
합성곱 계층과 거의 동일한 과정을 거친다.

이와 같은 구조를 그림으로 나타내면 [@fig:model]과 같다.

![공간배치 분석 모형](nn.pdf){#fig:model}

### 결과

평면도에서 추출한 공간배치 정보만으로 준공연도를 잘 예측하는 신경망을 학습시킬 수 있었다.

<div id="fig:">

![아파트 전체](prediction.pdf){height=40%}

![테스트 데이터셋 한정](prediction_testonly.pdf){height=40%}

공간배치를 통한 준공연도 예측
</div>

잠재표현 계층에서 평면도를 표현한 64차원의 값을
차원축소를 위해 ICA를 적용한 결과
7개 요인으로 축소하여도 95.7%의 분산을 설명할 수 있는 것으로 나타났다.

### 해석

시기에 따라 달라지는 한국 아파트 단위세대의 계획 특성을
공간배치 데이터셋과 심층 신경망 학습을 통해 분석할 수 있다는 것을 의미한다.

## 지역별 평면계획의 시차 분석

![지역별 평면 사례 수](n_by_sido.png)

<div id="fig:">

![예측 준공연도 편차 중앙값 (흰 점)](year_dev_hexbin.png){height=40%}

![중앙값 대비 준공연도 편차의 분포](dev_by_year.png){height=40%}

예측 준공연도의 편차 분석
</div>

각 지역별 평균 편차가 실제로 차이가 나는지를 확인하기 위하여
지역별 평균 비교에 대한 t-검정 결과의 유의확률을
Holm-Sidak 법을 적용하여 최소한 하나의 제1종오류가 발생할 가능성(familywise error rate; FWER)이 0.05가 되도록 보정하여 분석하였다.

|지역               |평균 편차 (년) |
|-------            |       ------: |
|광주/전라                        |0.10|
|경기                             |0.07|
|대전/세종/충청                   |0.06|
|_제주_                           |  _-0.06_|
|대구/경북                        |-0.09|
|_강원_                           |  _-0.11_|
|부산/울산/경남                   |-0.14|
|인천                             |-0.15|
|서울                             |-0.35|

: 예측 준공연도의 중앙값 대비 지역별 평균 편차 {#tbl:}

분석 결과, 서울은 예측 준공연도의 편차가 전국 중앙값보다 평균적으로 0.35년, 약 4개월 정도 늦는 것으로 나타났다.
반대로, 경기도, 충청도, 전라도 및 해당 광역시는 예측 준공연도가 전국 중앙값보다 0.06년--0.10년 앞섰다.
인천과 경상도 및 해당 광역시는 경기도, 충청도, 전라도보다 통계적으로 유의하게 늦었으나, 서울보다는 앞서는 것으로 나타났다.
강원도와 제주도는 사례 수가 부족하여 지역 대부분과의 비교에서 의미 있는 차이를 파악할 수 없었다.

모든 지역의 평균 차이의 크기가 1년 미만으로, 평면계획과 준공연도 사이에 존재하는 다양한 영향 요인들을 배제할 수 있을 만큼 큰 차이는 없었다.

통계적으로 유의한 결과에도 불구하고, 현실적으로는 지역 사이에 평면유형이 큰 시차를 두고 적용되지 않는다는 결론을 내릴 수 있다.

## 소결

한국 아파트 단위평면 데이터셋을 활용해 시기에 따라 달라진 한국 아파트의 변화를 파악하고 단위평면의 공간배치에서 해당 시기를 추정하는 것이 가능했다.

또한, 이러한 변화과정의 지역별 시차를 분석하여, 한국 아파트의 진화는 전국에서 동시기적으로 이루어졌음을 확인하였다.

\clearpage
